<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue 模板 AST 详解 | Vue技术内幕</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/vue2-design/logo.png">
    <meta name="description" content="逐行级别的 Vue 源码分析">
    
    <link rel="preload" href="/vue2-design/assets/css/0.styles.5777f404.css" as="style"><link rel="preload" href="/vue2-design/assets/js/app.837a7cca.js" as="script"><link rel="preload" href="/vue2-design/assets/js/2.cf0be6b0.js" as="script"><link rel="preload" href="/vue2-design/assets/js/11.4686618e.js" as="script"><link rel="prefetch" href="/vue2-design/assets/js/10.e3902e21.js"><link rel="prefetch" href="/vue2-design/assets/js/12.3cff03b8.js"><link rel="prefetch" href="/vue2-design/assets/js/13.5313d9d9.js"><link rel="prefetch" href="/vue2-design/assets/js/14.d5e05c04.js"><link rel="prefetch" href="/vue2-design/assets/js/15.2f3e57ef.js"><link rel="prefetch" href="/vue2-design/assets/js/16.f553e01c.js"><link rel="prefetch" href="/vue2-design/assets/js/17.c7e4a170.js"><link rel="prefetch" href="/vue2-design/assets/js/18.d81a2d64.js"><link rel="prefetch" href="/vue2-design/assets/js/19.2c917c67.js"><link rel="prefetch" href="/vue2-design/assets/js/20.57ef8934.js"><link rel="prefetch" href="/vue2-design/assets/js/21.1a48145b.js"><link rel="prefetch" href="/vue2-design/assets/js/22.85b008d0.js"><link rel="prefetch" href="/vue2-design/assets/js/23.4b385428.js"><link rel="prefetch" href="/vue2-design/assets/js/24.d641742a.js"><link rel="prefetch" href="/vue2-design/assets/js/25.ff524328.js"><link rel="prefetch" href="/vue2-design/assets/js/26.99a1a92c.js"><link rel="prefetch" href="/vue2-design/assets/js/27.480cb78b.js"><link rel="prefetch" href="/vue2-design/assets/js/28.fc206081.js"><link rel="prefetch" href="/vue2-design/assets/js/29.2aed9317.js"><link rel="prefetch" href="/vue2-design/assets/js/3.d54a9e09.js"><link rel="prefetch" href="/vue2-design/assets/js/30.b107b7ae.js"><link rel="prefetch" href="/vue2-design/assets/js/31.6986cb68.js"><link rel="prefetch" href="/vue2-design/assets/js/32.1de5bc2b.js"><link rel="prefetch" href="/vue2-design/assets/js/33.4a5c14d0.js"><link rel="prefetch" href="/vue2-design/assets/js/34.bd74fc76.js"><link rel="prefetch" href="/vue2-design/assets/js/35.12a7af7d.js"><link rel="prefetch" href="/vue2-design/assets/js/36.73180dd5.js"><link rel="prefetch" href="/vue2-design/assets/js/37.1a1a2866.js"><link rel="prefetch" href="/vue2-design/assets/js/38.751937a5.js"><link rel="prefetch" href="/vue2-design/assets/js/39.80be30b6.js"><link rel="prefetch" href="/vue2-design/assets/js/4.927be09d.js"><link rel="prefetch" href="/vue2-design/assets/js/40.742d2f33.js"><link rel="prefetch" href="/vue2-design/assets/js/5.013641ff.js"><link rel="prefetch" href="/vue2-design/assets/js/6.59c30d38.js"><link rel="prefetch" href="/vue2-design/assets/js/7.3a058268.js"><link rel="prefetch" href="/vue2-design/assets/js/8.fff0a8b5.js"><link rel="prefetch" href="/vue2-design/assets/js/9.4dcc2c19.js">
    <link rel="stylesheet" href="/vue2-design/assets/css/0.styles.5777f404.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vue2-design/" class="home-link router-link-active"><!----> <span class="site-name">Vue技术内幕</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vue2-design/art/" class="nav-link">
  正文
</a></div><div class="nav-item"><a href="/vue2-design/appendix/" class="nav-link router-link-active">
  附录
</a></div><div class="nav-item"><a href="/vue2-design/more/" class="nav-link">
  扩展阅读
</a></div><div class="nav-item"><a href="/vue2-design/tools/" class="nav-link">
  辅助工具
</a></div><div class="nav-item"><a href="/vue2-design/donate/" class="nav-link">
  人之初
</a></div><div class="nav-item"><a href="/vue2-design/about/" class="nav-link">
  关于
</a></div> <a href="https://github.com/mewcoder/vue2-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vue2-design/art/" class="nav-link">
  正文
</a></div><div class="nav-item"><a href="/vue2-design/appendix/" class="nav-link router-link-active">
  附录
</a></div><div class="nav-item"><a href="/vue2-design/more/" class="nav-link">
  扩展阅读
</a></div><div class="nav-item"><a href="/vue2-design/tools/" class="nav-link">
  辅助工具
</a></div><div class="nav-item"><a href="/vue2-design/donate/" class="nav-link">
  人之初
</a></div><div class="nav-item"><a href="/vue2-design/about/" class="nav-link">
  关于
</a></div> <a href="https://github.com/mewcoder/vue2-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>附录</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue2-design/appendix/" aria-current="page" class="sidebar-link">附录</a></li><li><a href="/vue2-design/appendix/vue-prototype.html" class="sidebar-link">Vue 构造函数整理-原型</a></li><li><a href="/vue2-design/appendix/vue-global-api.html" class="sidebar-link">Vue 构造函数整理-全局API</a></li><li><a href="/vue2-design/appendix/vue-ins.html" class="sidebar-link">Vue 实例的设计</a></li><li><a href="/vue2-design/appendix/core-util.html" class="sidebar-link">core/util 目录下的工具方法全解</a></li><li><a href="/vue2-design/appendix/web-util.html" class="sidebar-link">platforms/web/util 目录下的工具方法全解</a></li><li><a href="/vue2-design/appendix/shared-util.html" class="sidebar-link">shared/util.js 文件工具方法全解</a></li><li><a href="/vue2-design/appendix/compiler-options.html" class="sidebar-link">编译器选项</a></li><li><a href="/vue2-design/appendix/ast.html" aria-current="page" class="active sidebar-link">Vue 模板 AST 详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#type" class="sidebar-link">type</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#expression" class="sidebar-link">expression</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#tokens" class="sidebar-link">tokens</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#tag" class="sidebar-link">tag</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#attrslist" class="sidebar-link">attrsList</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#attrsmap" class="sidebar-link">attrsMap</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#attrs" class="sidebar-link">attrs</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#props" class="sidebar-link">props</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#pre" class="sidebar-link">pre</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#ns" class="sidebar-link">ns</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#forbidden" class="sidebar-link">forbidden</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#parent" class="sidebar-link">parent</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#children" class="sidebar-link">children</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#ifconditions" class="sidebar-link">ifConditions</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#slotname" class="sidebar-link">slotName</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#slottarget" class="sidebar-link">slotTarget</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#slotscope" class="sidebar-link">slotScope</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#scopedslots" class="sidebar-link">scopedSlots</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#for、alias、iterator1、iterator2" class="sidebar-link">for、alias、iterator1、iterator2</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#if、elseif、else" class="sidebar-link">if、elseif、else</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#once" class="sidebar-link">once</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#key" class="sidebar-link">key</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#ref" class="sidebar-link">ref</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#refinfor" class="sidebar-link">refInFor</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#component" class="sidebar-link">component</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#inlinetemplate" class="sidebar-link">inlineTemplate</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#hasbindings" class="sidebar-link">hasBindings</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#events、nativeevents" class="sidebar-link">events、nativeEvents</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#directives" class="sidebar-link">directives</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#staticclass" class="sidebar-link">staticClass</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#classbinding" class="sidebar-link">classBinding</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#staticstyle、stylebinding" class="sidebar-link">staticStyle、styleBinding</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#plain" class="sidebar-link">plain</a></li><li class="sidebar-sub-header"><a href="/vue2-design/appendix/ast.html#iscomment" class="sidebar-link">isComment</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue-模板-ast-详解"><a href="#vue-模板-ast-详解" class="header-anchor">#</a> Vue 模板 AST 详解</h1> <h2 id="type"><a href="#type" class="header-anchor">#</a> type</h2> <p>节点元素描述对象的 <code>type</code> 属性用来标识一个节点的类型。</p> <ul><li>示例：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre></div><p>它有三个可取值，分别是 <code>1</code>、<code>2</code>、<code>3</code>，分别代表的含义是：</p> <ul><li><code>1</code>：代表当前节点类型为标签</li> <li><code>2</code>：包含字面量表达式的文本节点</li> <li><code>3</code>：普通文本节点或注释节点</li></ul> <h2 id="expression"><a href="#expression" class="header-anchor">#</a> expression</h2> <p>当节点类型为 <code>2</code> 时，该节点的元素描述对象会包含 <code>expression</code> 属性。</p> <ul><li>示例：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  expression<span class="token punctuation">:</span> <span class="token string">&quot;'abc'+_s(name)+'def'&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="tokens"><a href="#tokens" class="header-anchor">#</a> tokens</h2> <p>与 <code>expression</code> 类似，当节点类型为 <code>2</code> 时，该节点的元素描述对象会包含 <code>tokens</code> 属性。</p> <ul><li>示例：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  expression<span class="token punctuation">:</span> <span class="token string">&quot;'abc'+_s(name)+'def'&quot;</span><span class="token punctuation">,</span>
  tokens<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">'abc'</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token string">'@binding'</span><span class="token punctuation">:</span> <span class="token string">'_s(name)'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'def'</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>节点元素描述对象的 <code>tokens</code> 属性是用来给 <code>weex</code> 使用的，这里不做过多解释。</p> <h2 id="tag"><a href="#tag" class="header-anchor">#</a> tag</h2> <p>只有当节点类型为 <code>1</code>，即该节点为标签时其元素描述对象才会有 <code>tag</code> 属性，该属性的值代表标签的名字。</p> <ul><li>示例：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  tag<span class="token punctuation">:</span> <span class="token string">'div'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="attrslist"><a href="#attrslist" class="header-anchor">#</a> attrsList</h2> <p>只有当节点类型为 <code>1</code>，即该节点为标签时其元素描述对象才会有 <code>attrsList</code> 属性，它是一个对象数组，存储着原始的 <code>html</code> 属性名和值。</p> <ul><li>示例：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  attrsList<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'v-for'</span><span class="token punctuation">,</span>
      value<span class="token punctuation">:</span> <span class="token string">'obj of list'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'class'</span><span class="token punctuation">,</span>
      value<span class="token punctuation">:</span> <span class="token string">'box'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="attrsmap"><a href="#attrsmap" class="header-anchor">#</a> attrsMap</h2> <p>节点元素描述对象的 <code>attrsMap</code> 属性与 <code>attrsList</code> 属性一样，不同点在于 <code>attrsMap</code> 是以键值对的方式保存 <code>html</code> 属性名和值的。</p> <ul><li>示例：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  attrsMap<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'v-for'</span><span class="token punctuation">:</span> <span class="token string">'obj of list'</span><span class="token punctuation">,</span>
    <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'box'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="attrs"><a href="#attrs" class="header-anchor">#</a> attrs</h2> <p>节点元素描述对象的 <code>attrs</code> 属性也是一个数组，并且也只有当节点类型为 <code>1</code>，即节点为标签的时候，其元素描述对象才会包含这个属性。<code>attrs</code> 属性不同于 <code>attrsList</code> 属性，具体表现在：</p> <ul><li>1、<code>attrsList</code> 属性仅用于解析阶段，而 <code>attrs</code> 属性则用于代码生成阶段，甚至运行时阶段。</li> <li>2、<code>attrsList</code> 属性所包含的内容作为元素材料被解析器使用，而 <code>attrs</code> 属性所包含的内容在运行时阶段会使用原生 <code>DOM</code> 操作方法 <code>setAttribute</code> 真正将属性设置给 <code>DOM</code> 元素</li></ul> <p>简单来说 <code>attrs</code> 属性会包含以下内容：</p> <ul><li>1、大部分使用 <code>v-bind</code>(或其缩写<code>:</code>) 指令绑定的属性会被添加到 <code>attrs</code> 数组中。</li></ul> <p>为什么说大部分而不是全部呢？因为在 <code>Vue</code> 中有个 <code>Must Use Prop</code> 的概念，对于一个属性如果它是 <code>Must Use Prop</code> 的，则该属性不会被添加到 <code>attrs</code> 数组中，而是会被添加到元素描述对象的 <code>props</code> 数组中。</p> <p>如下 <code>html</code> 模板所示：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:some-attr</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>val<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>最终 <code>attrs</code> 数组将为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  attrs<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'some-attr'</span><span class="token punctuation">,</span>
      value<span class="token punctuation">:</span> <span class="token string">'val'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>2、普通的非绑定属性会被添加到 <code>attrs</code> 数组中。</li></ul> <p>如下 <code>html</code> 模板所示：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">no-binding-attr</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>val<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>最终 <code>attrs</code> 数组将为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  attrs<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'no-binding-attr'</span><span class="token punctuation">,</span>
      value<span class="token punctuation">:</span> <span class="token string">'&quot;val&quot;'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>大家观察绑定属性和非绑定属性在 <code>attrs</code> 数组中的却别？很容易能够发现，非绑定属性的属性值是经过 <code>JSON.stringify</code> 的，我们已经不止一次的提到过这么做的目的。</p> <ul><li>3、<code>slot</code> 特性会被添加到 <code>attrs</code> 数组中。</li></ul> <p>如下 <code>html</code> 模板所示：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>最终 <code>attrs</code> 数组将为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  attrs<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'slot'</span><span class="token punctuation">,</span>
      value<span class="token punctuation">:</span> <span class="token string">'&quot;header&quot;'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当然了由于 <code>slot</code> 本身是可绑定的属性，所以如果 <code>html</code> 模板如下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>最终 <code>attrs</code> 数组将为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  attrs<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'slot'</span><span class="token punctuation">,</span>
      value<span class="token punctuation">:</span> <span class="token string">'header'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>区别在于 <code>value</code> 值是非 <code>JSON.stringify</code> 化的。</p> <p>实际上，并不是出现在 <code>attrs</code> 数组中的属性就一定会使用 <code>setAttribute</code> 函数将其添加到 <code>DOM</code> 上，例如在运行时阶段，组件会根据该组件自身的 <code>props</code> 定义，从 <code>attrs</code> 中抽离出那些作为组件 <code>props</code> 的属性元素。</p> <h2 id="props"><a href="#props" class="header-anchor">#</a> props</h2> <p>节点元素描述对象的 <code>props</code> 属性也是一个数组，它的格式与 <code>attrs</code> 数组类似。就像 <code>attrs</code> 数组中的属性在运行时阶段会使用 <code>setAttribute</code> 函数将其添加到 <code>DOM</code> 上一样，<code>props</code> 数组中的属性则会直接通过 <code>DOM</code> 元素对象访问并添加，举个例子，假设 <code>props</code> 数组如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  props<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'innerHTML'</span><span class="token punctuation">,</span>
      value<span class="token punctuation">:</span> <span class="token string">'&quot;some text&quot;'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>则在运行时阶段，会使用如下代码操作 <code>DOM</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code>elm<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'some text'</span>
</code></pre></div><p>其中 <code>elm</code> 为 <code>DOM</code> 节点对象。</p> <p>那么那些属性会被当做 <code>props</code> 呢？有两种，第一种是在绑定属性时使用了 <code>prop</code> 修饰符，例如：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:some.prop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>aaa<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>由于绑定 <code>some</code> 属性的时候使用了 <code>prop</code> 修饰符，所以 <code>some</code> 属性不会出现在元素描述对象的 <code>attrs</code> 数组中，而是会出现在元素描述对象的 <code>props</code> 数组中。</p> <p>第二种是那些比较特殊的属性，在绑定这些属性时，即使没有指定 <code>prop</code> 修饰符，但是由于它属于 <code>Must Use Prop</code> 的，所以这些属性会被强制添加到元素描述对象的 <code>props</code> 数组中，只有那些属性是 <code>Must Use Prop</code>，可以查看附录：<a href="/vue2-design/appendix/web-util.html#mustuseprop">mustuseprop</a></p> <h2 id="pre"><a href="#pre" class="header-anchor">#</a> pre</h2> <p>节点元素描述对象的 <code>pre</code> 属性是一个布尔值，它的真假代表着标签是否使用了 <code>v-pre</code> 指令，既然是标签，所以只有当节点的类型为 <code>1</code> 的时候其元素描述对象才会拥有 <code>pre</code> 属性。</p> <ul><li>示例：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  pre<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="ns"><a href="#ns" class="header-anchor">#</a> ns</h2> <p>标签的 <code>Namespace</code>，如果一个标签是 <code>SVG</code> 标签，则该标签的元素描述对象将会拥有 <code>ns</code> 属性，其值为 <code>'svg'</code>，如果一个标签是 <code>&lt;math&gt;</code> 标签，则该标签元素描述对象的 <code>ns</code> 属性值为字符串 <code>'math'</code>。</p> <ul><li>示例：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  ns<span class="token punctuation">:</span> <span class="token string">'svg'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="forbidden"><a href="#forbidden" class="header-anchor">#</a> forbidden</h2> <p>节点元素描述对象的 <code>forbidden</code> 属性是一个布尔值，其真假代表着该节点是否是在 <code>Vue</code> 模板中禁止被使用的。在 <code>Vue</code> 模板中满足以下条件的标签为禁止使用的标签：</p> <ul><li>1、<code>&lt;style&gt;</code> 标签禁止出现在模板中。</li> <li>2、没有指定 <code>type</code> 属性的 <code>&lt;script&gt;</code> 标签，或 <code>type</code> 属性值为 <code>'text/javascript'</code> 的 <code>&lt;script&gt;</code> 标签。</li></ul> <h2 id="parent"><a href="#parent" class="header-anchor">#</a> parent</h2> <p>节点元素描述对象的 <code>parent</code> 属性是父节点元素描述对象的引用。</p> <h2 id="children"><a href="#children" class="header-anchor">#</a> children</h2> <p>节点元素描述对象的 <code>children</code> 属性是一个数组，存储着该节点所有子节点的元素描述对象。当然了有些节点是不可能拥有子节点的，比如普通文本节点，对于不可能拥有子节点的节点，其元素描述对象没有 <code>children</code> 属性。</p> <ul><li>示例：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token comment">// 其他节点属性...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="ifconditions"><a href="#ifconditions" class="header-anchor">#</a> ifConditions</h2> <p>如果一个标签使用 <code>v-if</code> 指令，则该标签的元素描述对象将会拥有 <code>ifConditions</code> 属性，它是一个数组。如果一个标签使用 <code>v-else-if</code> 或 <code>v-else</code> 指令，则该标签不会被添加到其父节点元素描述对象的 <code>children</code> 数组中，而是会被添加到相符的带有 <code>v-if</code> 指令节点的元素描述对象的 <code>ifConditions</code> 数组中。</p> <p>假设有如下模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>a<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>b<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-else</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则 <code>&lt;div&gt;</code> 标签元素描述对象将是：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  tag<span class="token punctuation">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
  ifConditions<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      exp<span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span>
      block<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> tag<span class="token punctuation">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span> ifConditions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span> <span class="token comment">/* 省略其他属性 */</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      exp<span class="token punctuation">:</span> <span class="token string">'b'</span><span class="token punctuation">,</span>
      block<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> tag<span class="token punctuation">:</span> <span class="token string">'h1'</span> <span class="token comment">/* 省略其他属性 */</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      exp<span class="token punctuation">:</span> undefined<span class="token punctuation">,</span>
      block<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> tag<span class="token punctuation">:</span> <span class="token string">'p'</span> <span class="token comment">/* 省略其他属性 */</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 其他属性...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以发现一个节点元素描述对象的 <code>ifConditions</code> 数组中也会包含节点自身的元素描述对象。</p> <h2 id="slotname"><a href="#slotname" class="header-anchor">#</a> slotName</h2> <p>只有 <code>&lt;slot&gt;</code> 标签的元素描述对象才会拥有 <code>slotName</code> 属性，代表该插槽的名字，假设模板如下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>则元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  tag<span class="token punctuation">:</span> <span class="token string">'slot'</span><span class="token punctuation">,</span>
  slotName<span class="token punctuation">:</span> <span class="token string">'&quot;header&quot;'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意 <code>&lt;slot&gt;</code> 标签的 <code>name</code> 属性可以是绑定的：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">:name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dynamicName<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>则元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  tag<span class="token punctuation">:</span> <span class="token string">'slot'</span><span class="token punctuation">,</span>
  slotName<span class="token punctuation">:</span> <span class="token string">'dynamicName'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果没有为 <code>&lt;slot&gt;</code> 标签指定 <code>name</code> 属性，则其元素描述对象的 <code>slotName</code> 属性为：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  tag<span class="token punctuation">:</span> <span class="token string">'slot'</span><span class="token punctuation">,</span>
  slotName<span class="token punctuation">:</span> <span class="token string">'&quot;&quot;'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="slottarget"><a href="#slottarget" class="header-anchor">#</a> slotTarget</h2> <p>如果一个标签使用了 <code>slot</code> 特性，则说明该标签将会被作为插槽的内容，为了标识该标签将被插入的位置，该标签的元素描述对象会拥有 <code>slotTarget</code> 属性，假如有如下模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  tag<span class="token punctuation">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
  slotTarget<span class="token punctuation">:</span> <span class="token string">'&quot;header&quot;'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们来对比一下使用 <code>name</code> 属性的 <code>&lt;slot&gt;</code> 标签的元素描述对象：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  tag<span class="token punctuation">:</span> <span class="token string">'slot'</span><span class="token punctuation">,</span>
  slotName<span class="token punctuation">:</span> <span class="token string">'&quot;header&quot;'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以发现 <code>slotTarget</code> 和 <code>slotName</code> 是一一对象的，这将会在运行时阶段用来寻找合适的插槽内容。</p> <p>另外 <code>slot</code> 特性也可以是绑定的：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dynamicTarger<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  tag<span class="token punctuation">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
  slotTarget<span class="token punctuation">:</span> <span class="token string">'dynamicTarger'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果没有为 <code>slot</code> 特性指定属性值，则该标签元素描述对象的 <code>slotTarget</code> 属性的值为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  tag<span class="token punctuation">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
  slotTarget<span class="token punctuation">:</span> <span class="token string">'&quot;default&quot;'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="slotscope"><a href="#slotscope" class="header-anchor">#</a> slotScope</h2> <p>我们可以使用 <code>slot-scope</code> 特性来指定一个插槽内容是作用域插槽，此时该标签的元素描述对象将拥有 <code>slotScope</code> 属性，假如有如下模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>scopeData<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  tag<span class="token punctuation">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
  slotScope<span class="token punctuation">:</span> <span class="token string">'scopeData'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="scopedslots"><a href="#scopedslots" class="header-anchor">#</a> scopedSlots</h2> <p>同常情况下我们插槽是作为一个组件的子节点去书写的，如下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comp</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comp</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>如上代码所示我们有自定义组件 <code>&lt;copm&gt;</code>，并为该自定义组件提供了插槽内容。普通插槽会出现在组件元素描述对象的 <code>children</code> 数组中，如下是以上模板的 <code>AST</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
  tag<span class="token punctuation">:</span> <span class="token string">'comp'</span><span class="token punctuation">,</span>
  children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      tag<span class="token punctuation">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
      slotTarget<span class="token punctuation">:</span> <span class="token string">'&quot;header&quot;'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>但如果一个插槽不是普通插槽，而是作用域插槽，则该插槽节点的元素描述对象不会作为组件的 <code>children</code> 属性存在，而是会被添加到组件元素描述对象的 <code>scopedSlots</code> 属性中，假设有如下模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comp</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>scopeData<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comp</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其生成的 <code>AST</code> 为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
  tag<span class="token punctuation">:</span> <span class="token string">'comp'</span><span class="token punctuation">,</span>
  children<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  scopedSlots<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'&quot;header&quot;'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      tag<span class="token punctuation">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
      slotTarget<span class="token punctuation">:</span> <span class="token string">'&quot;header&quot;'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以发现 <code>scopedSlots</code> 对象的键值是作用域插槽元素描述对象的 <code>slotTarget</code> 属性的值。</p> <h2 id="for、alias、iterator1、iterator2"><a href="#for、alias、iterator1、iterator2" class="header-anchor">#</a> for、alias、iterator1、iterator2</h2> <p>当标签使用了 <code>v-for</code> 指令时，其元素描述对象将会拥有以上这四个属性，在如上四个属性中，其中 <code>for</code>、<code>alias</code> 这两个属性是肯定存在的，而 <code>iterator1</code> 和 <code>iterator2</code> 这两个属性不一定会存在。</p> <p>如果模板如下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>obj of list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>
  alias<span class="token punctuation">:</span> <span class="token string">'obj'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果模板如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>div v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;(obj, index) of list&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>
  alias<span class="token punctuation">:</span> <span class="token string">'obj'</span><span class="token punctuation">,</span>
  iterator1<span class="token punctuation">:</span> <span class="token string">'index'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果模板如下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(obj, key, index) of list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>
  alias<span class="token punctuation">:</span> <span class="token string">'obj'</span><span class="token punctuation">,</span>
  iterator1<span class="token punctuation">:</span> <span class="token string">'key'</span>
  iterator2<span class="token punctuation">:</span> <span class="token string">'index'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="if、elseif、else"><a href="#if、elseif、else" class="header-anchor">#</a> if、elseif、<code>else</code></h2> <p>如果一个标签使用了 <code>v-if</code> 指令，则该标签元素描述对象就会拥有 <code>if</code> 属性，假如有如下模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>a<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">:</span> <span class="token string">'a'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果一个标签使用了 <code>v-else-if</code> 指令，则该标签元素描述对象就会拥有 <code>elseif</code> 属性，假如有如下模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>b<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  elseif<span class="token punctuation">:</span> <span class="token string">'b'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果一个标签使用了 <code>v-else</code> 指令，则该标签元素描述对象就会拥有 <code>else</code> 属性，假如有如下模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="once"><a href="#once" class="header-anchor">#</a> once</h2> <p>使用标签使用了 <code>v-once</code> 指令，则该标签的元素描述对象就会包含 <code>once</code> 属性，它是一个布尔值，如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  once<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="key"><a href="#key" class="header-anchor">#</a> key</h2> <p>如果标签使用 <code>key</code> 特性，则该标签的元素描述对象就会包含 <code>key</code> 属性，假设有如下模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>unique<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  key<span class="token punctuation">:</span> <span class="token string">'&quot;unique&quot;'</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>key</code> 特性可以是绑定的：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>unique<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  key<span class="token punctuation">:</span> <span class="token string">'unique'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="ref"><a href="#ref" class="header-anchor">#</a> ref</h2> <p>与 <code>key</code> 类似，假设有如下模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>domRef<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  ref<span class="token punctuation">:</span> <span class="token string">'&quot;domRef&quot;'</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>ref</code> 特性可以是绑定的：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>domRef<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  ref<span class="token punctuation">:</span> <span class="token string">'domRef'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="refinfor"><a href="#refinfor" class="header-anchor">#</a> refInFor</h2> <p>元素描述对象的 <code>refInFor</code> 是一个布尔值。如果一个使用了 <code>ref</code> 特性的标签是使用了 <code>v-for</code> 指令标签的子代节点，则该标签元素描述对象的 <code>checkInFor</code> 属性将会为 <code>true</code>，否则为 <code>false</code></p> <h2 id="component"><a href="#component" class="header-anchor">#</a> component</h2> <p>如果标签使用 <code>is</code> 特性，则其元素描述对象将会拥有 <code>component</code> 属性，假设有如下模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>currentView<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  tag<span class="token punctuation">:</span> <span class="token string">'component'</span><span class="token punctuation">,</span>
  component<span class="token punctuation">:</span> <span class="token string">'currentView'</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>is</code> 特性也可以是非绑定的：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name">is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>my-row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则 <code>&lt;tr&gt;</code> 标签的元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  tag<span class="token punctuation">:</span> <span class="token string">'tr'</span><span class="token punctuation">,</span>
  component<span class="token punctuation">:</span> <span class="token string">'&quot;my-row&quot;'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="inlinetemplate"><a href="#inlinetemplate" class="header-anchor">#</a> inlineTemplate</h2> <p>节点元素描述对象的 <code>inlineTemplate</code> 属性是一个布尔值，标识着一个组件使用使用内联模板，假设我们有如下模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>copm</span> <span class="token attr-name">inline-template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>copm</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  inlineTemplate<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="hasbindings"><a href="#hasbindings" class="header-anchor">#</a> hasBindings</h2> <p>节点元素描述对象的 <code>hasBindings</code> 属性是一个布尔值，用来标签当前节点是否拥有绑定，所谓绑定指的就是指令。所以如果一个标签使用了指令(包括自定义指令)，则其元素描述对象的 <code>hasBindings</code> 属性就会为 <code>true</code>。</p> <p>这里要强调一点，事件本身也是指令(<code>v-on</code> 指令)，绑定的属性也是指令(<code>v-bind</code> 指令)。</p> <h2 id="events、nativeevents"><a href="#events、nativeevents" class="header-anchor">#</a> events、nativeEvents</h2> <p>如果标签使用了 <code>v-on</code> 指令(或缩写 <code>@</code>)绑定了事件，则该标签元素描述对象中将包含 <code>events</code> 属性，假如有如下模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handleClick<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  events<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'click'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">:</span> <span class="token string">'handleClick'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果在绑定事件的时候使用了修饰符，如下模板所示：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">@click.stop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handleClick<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  events<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'click'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">:</span> <span class="token string">'handleClick'</span><span class="token punctuation">,</span>
      modifiers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        stop<span class="token punctuation">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到多出了 <code>modifiers</code> 对象。</p> <p>但并不是所有修饰符都会出现在 <code>modifiers</code> 对象中，如下模板所示：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">@click.once</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handleClick<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>如上模板中我们使用了 <code>once</code> 修饰符，但它并不会出现在 <code>modifiers</code> 对象中，其最终生成的元素描述对象如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  events<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'~click'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">:</span> <span class="token string">'handleClick'</span><span class="token punctuation">,</span>
      modifiers<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到 <code>modifiers</code> 是一个空对象，但是事件名字由 <code>click</code> 变成了 <code>~click</code>。实际上对于一个使用了 <code>once</code> 修饰符的事件绑定，解析器会在原始事件名称前添加 <code>~</code> 符并将其作为新的事件名称，接着会忽略 <code>once</code> 修饰符，所以 <code>once</code> 修饰符不会出现在 <code>modifiers</code> 对象中。为什么要忽略 <code>once</code> 修饰符呢？因为对于后面的程序来讲，该修饰符已经没有使用的必要的，因为通过检查事件名称的第一个字符是否为 <code>~</code> 即可判断该事件是否为 <code>once</code> 的。除了 <code>once</code> 修饰符之外，以下列出的修饰符也不会出现在 <code>modifiers</code> 对象中：</p> <ul><li>1、事件名称为 <code>click</code> 并使用了 <code>right</code> 修饰符，则 <code>right</code> 修饰符不会出现在 <code>modifiers</code> 对象中，因为在解析阶段使用了 <code>right</code> 修饰符的 <code>click</code> 事件会被重写为 <code>contextmenu</code> 事件，假如有如下模板：</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">@click.right</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handler<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  events<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    contextmenu<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">:</span> <span class="token string">&quot;handler&quot;</span><span class="token punctuation">,</span>
      modifiers<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>2、<code>capture</code>、<code>passive</code> 修饰符不会出现在 <code>modifiers</code> 对象中，原因与 <code>once</code> 修饰符一样，<code>capture</code>、<code>passive</code> 修饰符也会修改事件的名称，其中 <code>capture</code> 修饰符会在原始事件名称之前添加 <code>!</code>，<code>passive</code> 修饰符会在事件名称之前添加 <code>&amp;</code>，假如有如下模板</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">@click.capture</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handler<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">@click.passive</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handler<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则对于的元素描述对象分别为：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用了 `capture` 修饰符</span>
ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  events<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'!click'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">:</span> <span class="token string">&quot;handler&quot;</span><span class="token punctuation">,</span>
      modifiers<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用了 `passive` 修饰符</span>
ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  events<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'&amp;click'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">:</span> <span class="token string">&quot;handler&quot;</span><span class="token punctuation">,</span>
      modifiers<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>3、<code>native</code> 修饰符也不会出现在 <code>modifiers</code> 对象中，原因很简单，<code>native</code> 修饰符是用来给解析器使用的，当解析器遇到使用了 <code>native</code> 修饰符的事件，则会将事件信息添加到元素描述对象的 <code>nativeEvents</code> 属性中，而不是 <code>events</code> 属性中，例如：</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comp</span> <span class="token attr-name">@click.native</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handler<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>copm</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  nativeEvents<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    click<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">:</span> <span class="token string">&quot;handler&quot;</span><span class="token punctuation">,</span>
      modifiers<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>除了以上修饰符之外，其他所有修饰符都会出现在 <code>modifiers</code> 对象中。</p> <h2 id="directives"><a href="#directives" class="header-anchor">#</a> directives</h2> <p>节点元素对象的 <code>directives</code> 属性是一个数组，用来保存标签中所有指令信息。但并不是所有指令信息都会保存在 <code>directives</code> 数组中，比如 <code>v-for</code> 指令和 <code>v-if</code> 指令等等，因为这些指令在之前的处理中已经被移除掉。总的来说，指令分为内置指令和自定义指令，真正会出现在 <code>directives</code> 数组中的只有部分内置指令以及全部自定义指令。</p> <p>不会出现在 <code>directives</code> 数组中的内置指令有：<code>v-pre</code>、<code>v-for</code>、<code>v-if</code>、<code>v-else-if</code>、<code>v-else</code> 以及 <code>v-once</code>。</p> <p>会出现在 <code>directives</code> 数组中的内置有：<code>v-text</code>、<code>v-html</code>、<code>v-show</code>、<code>v-model</code> 以及 <code>v-cloak</code>。</p> <p>另外 <code>v-on</code>、<code>v-bind</code> 是两个比较特殊的指令，当这两个指令拥有参数时，则不会出现在 <code>directives</code> 数组中，比如：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handler<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>some-prop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>val<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>以上这两中写法，由于 <code>v-on</code> 和 <code>v-bind</code> 指令拥有参数，所以这两个指令不会出现在 <code>directives</code>，但是我们知道 <code>v-on</code> 和 <code>v-bind</code> 指令可以直接绑定对象，此时他们是没有参数的：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-on</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>$listeners<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>$attrs<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这时候 <code>v-on</code> 和 <code>v-bind</code> 指令都会出现在 <code>directives</code> 数组中。为什么同样指令不同的使用方式会得到不同的对待呢？其实正是由于使用方式的不同，才需要不同的处理，在代码生成阶段，我们会更加理解这一点。</p> <p>一个完整的指令由四部分组成，分别是：<code>指令的名称</code>、<code>指令表达式</code>、<code>指令参数</code> 以及 <code>指令修饰符</code>，假设有如下模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">v-custom-dir:</span>arg.modif</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>val<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>如上模板展示了一个完整的指令，最终其生成的元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  directives<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'custom-dir'</span><span class="token punctuation">,</span>
      rawName<span class="token punctuation">:</span> <span class="token string">'v-custom-dir:arg.modif'</span><span class="token punctuation">,</span>
      value<span class="token punctuation">:</span> <span class="token string">'val'</span><span class="token punctuation">,</span>
      arg<span class="token punctuation">:</span> <span class="token string">'arg'</span><span class="token punctuation">,</span>
      modifiers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        modif<span class="token punctuation">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="staticclass"><a href="#staticclass" class="header-anchor">#</a> staticClass</h2> <p>如果以标签使用了静态 <code>class</code>，即非绑定的 <code>class</code>，那么该标签的元素描述对象将拥有 <code>staticClass</code> 属性，假设有如下模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>a b c<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  staticClass<span class="token punctuation">:</span> <span class="token string">'&quot;a b c&quot;'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="classbinding"><a href="#classbinding" class="header-anchor">#</a> classBinding</h2> <p><code>staticClass</code> 属性中存储的是静态 <code>class</code> ，而元素描述对象的 <code>classBinding</code> 属性中所存储的则是绑定的 <code>class</code>，假设有如下模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{ active: true }<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  classBinding<span class="token punctuation">:</span> <span class="token string">'{ active: true }'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="staticstyle、stylebinding"><a href="#staticstyle、stylebinding" class="header-anchor">#</a> staticStyle、styleBinding</h2> <p>节点元素描述对象的 <code>staticStyle</code> 属于包含的是静态 <code>style</code> 内联样式信息，假设有如下模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  staticStyle<span class="token punctuation">:</span> <span class="token string">'{&quot;color&quot;:&quot;red&quot;,&quot;background&quot;:&quot;green&quot;}'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以发现 <code>staticStyle</code> 属性的值不是简单的把 <code>style</code> 内联样式拷贝下来，而是将其解析成了对象的样子。</p> <p><code>styleBinding</code> 属性类似于 <code>classBinding</code> 属性。假设有如下模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:</span><span class="token style-attr language-css"><span class="token attr-name"><span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token punctuation">{</span> <span class="token property">backgroundColor</span><span class="token punctuation">:</span> green <span class="token punctuation">}</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>则其元素描述对象为：</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  styleBinding<span class="token punctuation">:</span> <span class="token string">'{ backgroundColor: green }'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="plain"><a href="#plain" class="header-anchor">#</a> plain</h2> <p>节点元素描述对象的 <code>plain</code> 属性是一个布尔值，<code>plain</code> 属性的真假将影响代码生成阶段对于 <code>VNodeData</code> 的生成。什么是 <code>VNodeData</code> 呢？在 <code>Vue</code> 中一个 <code>VNode</code> 代表一个虚拟节点，而 <code>VNodeData</code> 就是用来描述该虚拟节点的管家信息。在代码生成节点我们会发现 <code>AST</code> 中元素的大部分信息都用来生成 <code>VNodeData</code>。对于一个节点的元素描述对象来讲，如果其 <code>plain</code> 属性值为 <code>true</code>，该节点所对应的虚拟节点将不包含任何 <code>VNodeData</code>。</p> <ul><li><p>1、如果一个标签是使用了 <code>v-pre</code> 指令标签的子代标签，则该标签元素描述对象的 <code>plain</code> 属性将使用为 <code>true</code>。但要注意的是，使用了 <code>v-pre</code> 指令的那个标签的元素描述对象的 <code>plain</code> 属性不为 <code>true</code>。</p></li> <li><p>2、如果你标签既没有使用特性 <code>key</code>，又没有任何属性，那么该标签的元素描述对象的 <code>plain</code> 属性将始终为 <code>true</code>。</p></li></ul> <p>其实，我们完全可以认为，只有使用了 <code>v-pre</code> 指令的标签的子待节点其元素描述对象的 <code>plain</code> 属性才会为 <code>true</code>。</p> <h2 id="iscomment"><a href="#iscomment" class="header-anchor">#</a> isComment</h2> <p>节点元素描述对象的 <code>isComment</code> 属性是一个布尔值，用来标识当前节点是否是注释节点。所以只有注释节点的元素描述对象才会有这个属性，并且其值为 <code>true</code>。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/mewcoder/vue2-design/edit/master/docs/appendix/ast.md" target="_blank" rel="noopener noreferrer">错别字纠正</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue2-design/appendix/compiler-options.html" class="prev">
        编译器选项
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vue2-design/assets/js/app.837a7cca.js" defer></script><script src="/vue2-design/assets/js/2.cf0be6b0.js" defer></script><script src="/vue2-design/assets/js/11.4686618e.js" defer></script>
  </body>
</html>
